name: Strategy Management

on:
  schedule:
    - cron: '0 * * * *'  # æ¯å°æ™‚
  workflow_dispatch:

jobs:
  strategy-management:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3

      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip --quiet
          pip install --quiet backtrader numpy scikit-learn tensorflow requests

      - name: ğŸ•’ Create Logs Directory
        run: mkdir -p logs

      - name: â–¶ï¸ Run Strategy Manager
        run: |
          echo "ğŸ¤– åŸ·è¡Œç­–ç•¥ç®¡ç†å¸« at $(date '+%Y-%m-%d %H:%M:%S')"
          python scripts/strategy_manager.py 2>&1 | tee -a logs/strategy_manager.log
          echo "âœ… å®Œæˆ at $(date '+%Y-%m-%d %H:%M:%S')"
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}

      - name: ğŸ’¾ Commit and Push Logs
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add logs/strategy_manager.log
          git commit -m "Update strategy logs [$(date '+%Y-%m-%d %H:%M:%S')] " || echo "â„¹ï¸ No changes"
          git push