name: Strategy Management

on:
  schedule:
    - cron: '0 * * * *'  # 每小時
  workflow_dispatch:

jobs:
  strategy-management:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v3

      - name: 🐍 Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 📦 Install Dependencies
        run: |
          python -m pip install --upgrade pip --quiet
          pip install --quiet backtrader numpy scikit-learn tensorflow requests

      - name: 🕒 Create Logs Directory
        run: mkdir -p logs

      - name: ▶️ Run Strategy Manager
        run: |
          echo "🤖 執行策略管理師 at $(date '+%Y-%m-%d %H:%M:%S')"
          python scripts/strategy_manager.py 2>&1 | tee -a logs/strategy_manager.log
          echo "✅ 完成 at $(date '+%Y-%m-%d %H:%M:%S')"
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}

      - name: 💾 Commit and Push Logs
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add logs/strategy_manager.log
          git commit -m "Update strategy logs [$(date '+%Y-%m-%d %H:%M:%S')] " || echo "ℹ️ No changes"
          git push