name: Test Data Collection Workflow

on:
workflow_dispatch:
inputs:
podcast_mode:
description: â€˜æ’­å®¢æ¨¡å¼ (tw/us)â€™
required: true
default: â€˜twâ€™
type: choice
options:
- tw
- us
simulate_time:
description: â€˜æ¨¡æ“¬æ™‚é–“ (HH:MM CST, ä¾‹å¦‚ 06:00 æˆ– 14:00)â€™
required: false
default: â€˜20:02â€™

jobs:
data-collection:
runs-on: ubuntu-latest
steps:
- name: Checkout Repository
uses: actions/checkout@v4

```
  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.11'  # ä½¿ç”¨è¼ƒæ–°ç‰ˆæœ¬

  - name: Install Dependencies
    run: |
      pip install pandas

  - name: Create Required Directories
    run: |
      mkdir -p data logs scripts

  - name: Run Data Collector
    env:
      PODCAST_MODE: ${{ inputs.podcast_mode }}
      SIMULATE_TIME: ${{ inputs.simulate_time }}
    run: |
      echo "ðŸ“¥ é–‹å§‹åŸ·è¡Œè³‡æ–™æ”¶é›†å“¡ - æ¨¡å¼: ${{ inputs.podcast_mode }}, æ™‚é–“: ${{ inputs.simulate_time }}"
      
      # æª¢æŸ¥è…³æœ¬æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å‰‡å‰µå»ºæ¨¡æ“¬è…³æœ¬
      if [ ! -f "scripts/data_collector.py" ]; then
        echo "âš ï¸ å‰µå»ºæ¨¡æ“¬è…³æœ¬"
        cat > scripts/data_collector.py << 'EOF'
```

import os
import pandas as pd
from datetime import datetime

def main():
mode = os.getenv(â€˜PODCAST_MODEâ€™, â€˜twâ€™)
simulate_time = os.getenv(â€˜SIMULATE_TIMEâ€™, â€˜20:02â€™)

```
print(f"æ•¸æ“šæ”¶é›†é–‹å§‹ - æ¨¡å¼: {mode}, æ¨¡æ“¬æ™‚é–“: {simulate_time}")

# å‰µå»ºæ•¸æ“šç›®éŒ„
data_dir = "data"
os.makedirs(data_dir, exist_ok=True)

# ç”Ÿæˆæ¨¡æ“¬æ•¸æ“š
dates = pd.date_range('2024-01-01', periods=10, freq='D')
prices = 100 + (pd.Series(range(10)) * 0.1)
df = pd.DataFrame({
    'Date': dates, 
    'Close': prices,
    'Mode': mode,
    'SimulateTime': simulate_time
})

filename = f"{data_dir}/daily_{mode}.csv"
df.to_csv(filename, index=False)
print(f"âœ… æ•¸æ“šå·²ä¿å­˜åˆ°: {filename}")

# å¯«å…¥æ—¥èªŒ
log_dir = "logs"
os.makedirs(log_dir, exist_ok=True)
with open(f"{log_dir}/data_collector.log", "w", encoding='utf-8') as f:
    f.write(f"{datetime.now()}: Data collection completed for mode {mode}\n")
    f.write(f"Simulate time: {simulate_time}\n")
```

if **name** == â€œ**main**â€:
main()
EOF
fi

```
      # åŸ·è¡Œè…³æœ¬
      python scripts/data_collector.py
      
      # æª¢æŸ¥åŸ·è¡Œçµæžœ
      if [ $? -ne 0 ]; then
        echo "âŒ åŸ·è¡Œå¤±æ•—"
        exit 1
      fi
      
      echo "âœ… åŸ·è¡Œå®Œæˆï¼Œæª¢æŸ¥æª”æ¡ˆ:"
      ls -la data/

  - name: Verify Output
    run: |
      echo "ðŸ” é©—è­‰è¼¸å‡ºæª”æ¡ˆ..."
      
      # æª¢æŸ¥ CSV æª”æ¡ˆ
      if [ -f "data/daily_${{ inputs.podcast_mode }}.csv" ]; then
        echo "âœ… æ•¸æ“šæ–‡ä»¶ç”ŸæˆæˆåŠŸ: data/daily_${{ inputs.podcast_mode }}.csv"
        echo "ðŸ“„ æª”æ¡ˆå…§å®¹é è¦½:"
        head -5 "data/daily_${{ inputs.podcast_mode }}.csv"
      else
        echo "âŒ æ•¸æ“šæ–‡ä»¶æœªç”Ÿæˆ"
        exit 1
      fi
      
      # æª¢æŸ¥æ—¥èªŒæª”æ¡ˆ
      if [ -f "logs/data_collector.log" ]; then
        echo "âœ… æ—¥èªŒæ–‡ä»¶ç”ŸæˆæˆåŠŸ"
        echo "ðŸ“ æ—¥èªŒå…§å®¹:"
        cat "logs/data_collector.log"
      else
        echo "âš ï¸ æ—¥èªŒæ–‡ä»¶æœªç”Ÿæˆ"
      fi

  - name: Upload Artifacts
    uses: actions/upload-artifact@v3
    if: always()  # ç„¡è«–æˆåŠŸå¤±æ•—éƒ½ä¸Šå‚³
    with:
      name: data-collection-results-${{ inputs.podcast_mode }}
      path: |
        data/
        logs/
      retention-days: 30
```