name: Test Data Collection Workflow

on:
  workflow_dispatch:
    inputs:
      podcast_mode:
        description: '播客模式 (tw/us)'
        required: true
        default: 'tw'
        type: choice
        options:
          - tw
          - us
      simulate_time:
        description: '模擬時間 (HH:MM CST, 例如 06:00 或 14:00)'
        required: false
        default: '20:51'  # 當前時間約 20:51 CST

jobs:
  data-collection:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          path: repo
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - name: Install Dependencies
        working-directory: repo
        run: |
          pip install pandas
      - name: Run Data Collector
        working-directory: repo
        run: |
          echo "📥 開始執行資料收集員 - 模式: ${{ inputs.podcast_mode }}"
          python scripts/data_collector.py
          echo "✅ 執行完成，檢查檔案: ls -la data/"
      - name: Check Output
        working-directory: repo
        run: |
          if [ -f "data/daily_${{ inputs.podcast_mode }}.csv" ]; then
            echo "✅ 數據文件生成成功"
          else
            echo "❌ 數據文件未生成"
            exit 1
          fi