name: Test Data Collection Workflow

on:
  workflow_dispatch:
    inputs:
      podcast_mode:
        description: '播客模式 (tw/us)'
        required: true
        default: 'tw'
        type: choice
        options:
          - tw
          - us
      simulate_time:
        description: '模擬時間 (HH:MM CST, 例如 06:00 或 14:00)'
        required: false
        default: '20:34'  # 當前時間約 20:34 CST

jobs:
  data-collection:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          path: repo
      - name: Generate Mock Data
        working-directory: repo
        run: |
          echo "📥 開始生成模擬數據 - 模式: ${{ inputs.podcast_mode }}"
          mkdir -p data logs
          echo "date,close" > data/daily_${{ inputs.podcast_mode }}.csv
          for i in {0..9}; do
            echo "2024-01-0$i,100.$i" >> data/daily_${{ inputs.podcast_mode }}.csv
          done
          echo "✅ 數據已保存到: data/daily_${{ inputs.podcast_mode }}.csv"
          echo "$(date): Data generation completed" > logs/data_collector.log
          echo "✅ 生成完成，檢查檔案: ls -la data/"
      - name: Check Output
        working-directory: repo
        run: |
          if [ -f "data/daily_${{ inputs.podcast_mode }}.csv" ]; then
            echo "✅ 數據文件生成成功"
          else
            echo "❌ 數據文件未生成"
            exit 1
          fi