name: Test Data Collection Workflow

on:
workflow_dispatch:
inputs:
podcast_mode:
description: ‘Podcast mode (tw/us)’
required: true
default: ‘tw’
type: choice
options:
- tw
- us
simulate_time:
description: ‘Simulate time (HH:MM CST, e.g. 06:00 or 14:00)’
required: false
default: ‘20:02’

jobs:
data-collection:
runs-on: ubuntu-latest
steps:
- name: Checkout Repository
uses: actions/checkout@v4

```
  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.11'

  - name: Install Dependencies
    run: |
      pip install pandas

  - name: Create Required Directories
    run: |
      mkdir -p data logs scripts

  - name: Run Data Collector
    env:
      PODCAST_MODE: ${{ inputs.podcast_mode }}
      SIMULATE_TIME: ${{ inputs.simulate_time }}
    run: |
      echo "Starting data collection - Mode: ${{ inputs.podcast_mode }}, Time: ${{ inputs.simulate_time }}"
      
      if [ ! -f "scripts/data_collector.py" ]; then
        echo "Creating simulation script"
        cat > scripts/data_collector.py << 'EOF'
```

import os
import pandas as pd
from datetime import datetime

def main():
mode = os.getenv(‘PODCAST_MODE’, ‘tw’)
simulate_time = os.getenv(‘SIMULATE_TIME’, ‘20:02’)

```
print(f"Data collection started - Mode: {mode}, Simulate time: {simulate_time}")

data_dir = "data"
os.makedirs(data_dir, exist_ok=True)

dates = pd.date_range('2024-01-01', periods=10, freq='D')
prices = 100 + (pd.Series(range(10)) * 0.1)
df = pd.DataFrame({
    'Date': dates, 
    'Close': prices,
    'Mode': mode,
    'SimulateTime': simulate_time
})

filename = f"{data_dir}/daily_{mode}.csv"
df.to_csv(filename, index=False)
print(f"Data saved to: {filename}")

log_dir = "logs"
os.makedirs(log_dir, exist_ok=True)
with open(f"{log_dir}/data_collector.log", "w", encoding='utf-8') as f:
    f.write(f"{datetime.now()}: Data collection completed for mode {mode}\n")
    f.write(f"Simulate time: {simulate_time}\n")
```

if **name** == “**main**”:
main()
EOF
fi

```
      python scripts/data_collector.py
      
      if [ $? -ne 0 ]; then
        echo "Execution failed"
        exit 1
      fi
      
      echo "Execution completed, checking files:"
      ls -la data/

  - name: Verify Output
    run: |
      echo "Verifying output files..."
      
      if [ -f "data/daily_${{ inputs.podcast_mode }}.csv" ]; then
        echo "Data file generated successfully: data/daily_${{ inputs.podcast_mode }}.csv"
        echo "File content preview:"
        head -5 "data/daily_${{ inputs.podcast_mode }}.csv"
      else
        echo "Data file not generated"
        exit 1
      fi
      
      if [ -f "logs/data_collector.log" ]; then
        echo "Log file generated successfully"
        echo "Log content:"
        cat "logs/data_collector.log"
      else
        echo "Log file not generated"
      fi

  - name: Upload Artifacts
    uses: actions/upload-artifact@v3
    if: always()
    with:
      name: data-collection-results-${{ inputs.podcast_mode }}
      path: |
        data/
        logs/
      retention-days: 30
```

