name: Test Data Collection Workflow

on:
workflow_dispatch:
  inputs:
    podcast_mode:
      description: 'æ’­å®¢æ¨¡å¼ (tw/us)'
      required: true
      default: 'tw'
      type: choice
      options:
        - tw
        - us
    simulate_time:
      description: 'æ¨¡æ“¬æ™‚é–“ (HH:MM CST, ä¾‹å¦‚ 06:00 æˆ– 14:00)'
      required: false
      default: '19:42'  # ç•¶å‰æ™‚é–“ç´„ 19:42 CST

jobs:
data-collection:
  runs-on: ubuntu-latest
  steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
      with:
        path: repo
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    - name: Install Dependencies
      working-directory: repo
      run: |
        pip install pandas
    - name: Run Data Collector
      working-directory: repo
      run: |
        echo "ðŸ“¥ é–‹å§‹åŸ·è¡Œè³‡æ–™æ”¶é›†å“¡ - æ¨¡å¼: ${{ inputs.podcast_mode }}"
        mkdir -p data logs
        if [ ! -f "scripts/data_collector.py" ]; then
          echo "âš ï¸ å‰µå»ºæ¨¡æ“¬è…³æœ¬"
          cat > scripts/data_collector.py << 'EOF'
      import os
      import pandas as pd
      from datetime import datetime

def main():
  mode = os.getenv('PODCAST_MODE', '${{ inputs.podcast_mode }}')
  print(f"æ•¸æ“šæ”¶é›†é–‹å§‹ - æ¨¡å¼: {mode}")
  data_dir = "data"
  os.makedirs(data_dir, exist_ok=True)
  dates = pd.date_range('2024-01-01', periods=10, freq='D')
  prices = 100 + (pd.Series(range(10)) * 0.1)
  df = pd.DataFrame({'Date': dates, 'Close': prices})
  filename = f"{data_dir}/daily_{mode}.csv"
  df.to_csv(filename, index=False)
  print(f"âœ… æ•¸æ“šå·²ä¿å­˜åˆ°: {filename}")
  with open("logs/data_collector.log", "w") as f:
      f.write(f"{datetime.now()}: Data collection completed\n")

if __name__ == "__main__":
  main()
EOF
        fi
        python scripts/data_collector.py
        if [ $? -ne 0 ]; then
          echo "âŒ åŸ·è¡Œå¤±æ•—"
          exit 1
        fi
        echo "âœ… åŸ·è¡Œå®Œæˆï¼Œæª¢æŸ¥æª”æ¡ˆ: ls -la data/"
      continue-on-error: false
    - name: Check Output
      working-directory: repo
      run: |
        if [ -f "data/daily_${{ inputs.podcast_mode }}.csv" ]; then
          echo "âœ… æ•¸æ“šæ–‡ä»¶ç”ŸæˆæˆåŠŸ"
        else
          echo "âŒ æ•¸æ“šæ–‡ä»¶æœªç”Ÿæˆ"
          exit 1
        fi