name: Upload Manager

on:
  schedule:
    # æ¯å¤© 06:20 ä¸Šå‚³ç¾è‚¡æª”æ¡ˆ
    - cron: "20 22 * * *"  # UTC â†’ 06:20 TPE
    # æ¯å¤© 14:30 ä¸Šå‚³å°è‚¡æª”æ¡ˆ
    - cron: "30 6 * * *"   # UTC â†’ 14:30 TPE
    # æ¯å¤© 06:35 ç™¼ä½ˆç¾è‚¡ RSS Feed
    - cron: "35 22 * * *"  # UTC â†’ 06:35 TPE
    # æ¯å¤© 14:40 ç™¼ä½ˆå°è‚¡ RSS Feed
    - cron: "40 6 * * *"   # UTC â†’ 14:40 TPE

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run Upload Manager
        run: |
          python scripts/upload_manager.py

  publish-feed:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Publish Feed
        run: |
          if [ "$(date +'%H%M' -u)" == "2235" ]; then
            echo "ğŸ“¡ åŸ·è¡Œæ¨æ’­å“¡ (mode=us)"
            PODCAST_MODE=us python scripts/feed_publisher.py
          elif [ "$(date +'%H%M' -u)" == "0640" ]; then
            echo "ğŸ“¡ åŸ·è¡Œæ¨æ’­å“¡ (mode=tw)"
            PODCAST_MODE=tw python scripts/feed_publisher.py
          fi

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add docs/rss/
          git commit -m "æ›´æ–° Podcast RSS Feed"
          git push